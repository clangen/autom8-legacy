#!/bin/bash

NO_ARGS=0
E_OPTERROR=85
PREFIX=

echo "[*] parsing command line"

if [ $# -eq "$NO_ARGS" ]    # Script invoked with no command-line args?
then
  echo "usage: `basename $0` -p <prefix>"
  exit $E_OPTERROR
fi

while getopts "p:" OPTION
do
  case $OPTION in
    p) PREFIX=$OPTARG;;
  esac
done

if [ -z $PREFIX ]
then
    echo "no installation directory specified."
    exit
fi

echo "[*] *** REPLACING {{PREFIX}} with $PREFIX"
PREFIX=$(echo $PREFIX | sed 's_/_\\/_g') # cwd, with escaped slashes
find ./stage -type f -print0 | xargs -0 sed -i '' -e "s/{{PREFIX}}/$PREFIX/g"

# install debs

# echo "[*] installing npm modules"
# pushd build/stage/lib/autom8
# npm install colors prompt commander ffi ref express jsonminify lodash q socket.io socket.io-client stripcolorcodes
# popd

# create user

# copy to install dir

# chmod/chown files

# install init script